# 项目运行说明文档

## 1. 环境配置及依赖安装

### 1.1 操作系统信息

- 操作系统：`Linux`
- 版本：`4.18.0-372.32.1.el8_6.x86_64`
- 架构：`x86_64`

### 1.2 Python 版本

- Python 版本：`3.10.18`

### 1.3 Python 依赖

- Python 依赖：

- **深度学习相关库**：
  - torch==2.7.1
  - torchmetrics==1.7.3
  - torchvision==0.22.1
  - xformer==1.24.4
  - timm==1.0.15
  - triton==3.3.0
  - diffusers==0.33.1
  - safetensors==0.5.3

- **CUDA相关库**：
  - nvidia-cuda-cu12==12.6.4.1
  - nvidia-cudnn-cu12==9.5.1.17
  - nvidia-nccl-cu12==2.26.2
  - nvidia-cuda-nvrtc-cu12==12.6.77

- **常见工具和库**：
  - numpy==1.24.4
  - requests==2.32.4
  - psutil==7.0.0
  - protobuf==6.31.1
  - tensorboard==2.19.0
  - Jinja2==3.1.6
  - Markdown==3.8.2
  - pillow==11.2.1
  - packaging==25.0

查看所有已安装的依赖：

```bash
`pip freeze`
```

### 1.4 conda环境

- `base` 环境：位于 `/work/sustcsc_11/miniconda3`
- `DiT` 环境：位于 `/work/sustcsc_11/miniconda3/envs/DiT`
- `myenv` 环境：位于 `/work/sustcsc_11/miniconda3/envs/myenv`

### 1.5 GPU环境

- GPU型号：`NVIDIA V100 GPU (32GB)`
- CUDA版本：`11.8`

## 2. 依赖安装

以下是本项目的Python依赖，确保通过`pip`或`conda`安装以下包：

- diffusers==0.33.1
- numpy==1.24.4
- Pillow==11.2.1
- timm==1.0.15
- torch==2.7.0
- torchmetrics==1.7.3
- torchvision==0.22.0
- tqdm==4.66.4

## 3.编译步骤

本项目不涉及额外的编译步骤，直接依赖 Python 环境及深度学习框架。

## 4.运行步骤

### 4.1 如何启动程序

利用`job_xx.slurm`（作业提交脚本）提交代码，本项目中有多个优化版本的代码，会在下文更新说明。

### 4.2 运行结果

-每一份提交的作业都会`新生成以作业号命名的目录`，存放性能日志和生成的图像。都根据作业号命名。
-最优版本中已删除profiler。若使用未删除profiler的版本，性能日志将生成在对应作业的目录下。
  结果目录结构如下：

  ```shell
 <DiT-SUSTCSC>
 ├── output                     # 存储所有作业输出的目录
 │   ├── job_<job_id>/          # 每个作业的单独目录，包含该作业的所有相关文件
 │       ├── log_<job_id>/      # 该目录存储性能分析的日志文件
 │       │   ├── <log_files>    # 包含性能日志的文件（例如：.pt.trace.json 等）
 |       |   └── <stacks.txt>   # 调用栈分析报告，记录了所有 CUDA 运算中耗时最多的代码路径, 用于生成火焰图
 |       |   
 │       └── sample_<job_id>.png # 生成的采样图片

```

-测试过程中使用`profetto`和`TensorBoard`分析，上传profetto之前需先更改文件权限：

```bash
chmod 644 <file_path>
```

### 4.3 目前版本

|文件名|          配置| 提交脚本|
|------|----------|------------|
|sample_00.py        |     单卡baseline                      |   使用job_01.slurm运行（注意更改最后一行的运行脚本名称）
|sample_01.py         |    单卡添加TorchScript                |  使用job_01.slurm运行（注意更改最后一行的运行脚本名称）
| sample_02.py          |   四卡ddp + TorchScript + AMP         | 使用job_02.slurm运行  

✋bingo! 最新版sample_02.py 已就绪！
